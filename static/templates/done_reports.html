<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Completed Reports - CityFix</title>
  <meta name="description" content="Review and approve completed maintenance work reports in CityFix.">

  <!-- Favicon -->
  <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/dashboard.css') }}">

  <style>
    .reports-hero {
      background: linear-gradient(135deg, var(--emerald-500), var(--primary-500));
      color: white;
      padding: var(--space-12) 0;
      position: relative;
      overflow: hidden;
    }

    .reports-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="done-pattern" width="25" height="25" patternUnits="userSpaceOnUse"><circle cx="12.5" cy="12.5" r="2" fill="white" opacity="0.1"/><path d="M5 12.5l5 5 10-10" stroke="white" stroke-width="1" fill="none" opacity="0.05"/></pattern></defs><rect width="100" height="100" fill="url(%23done-pattern)"/></svg>');
    }

    .reports-content {
      position: relative;
      z-index: 1;
      text-align: center;
    }

    .reports-title {
      font-size: var(--text-4xl);
      font-weight: 800;
      margin-bottom: var(--space-4);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .reports-subtitle {
      font-size: var(--text-xl);
      opacity: 0.9;
      max-width: 600px;
      margin: 0 auto var(--space-8);
    }

    .filter-tabs {
      display: flex;
      justify-content: center;
      gap: var(--space-2);
      flex-wrap: wrap;
    }

    .filter-tab {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-3) var(--space-5);
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: var(--radius-full);
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: var(--text-sm);
      transition: var(--transition-all);
      cursor: pointer;
      backdrop-filter: blur(10px);
    }

    .filter-tab:hover,
    .filter-tab.active {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
      text-decoration: none;
      color: white;
      box-shadow: var(--shadow-lg);
    }

    .reports-container {
      max-width: 1400px;
      margin: calc(-1 * var(--space-8)) auto var(--space-16);
      position: relative;
      z-index: 2;
    }

    .reports-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
      gap: var(--space-8);
    }

    .report-card {
      background: white;
      border-radius: var(--radius-3xl);
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--gray-200);
      overflow: hidden;
      transition: var(--transition-all);
    }

    .report-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-2xl);
    }

    .report-header {
      padding: var(--space-6) var(--space-6) var(--space-4);
      border-bottom: 1px solid var(--gray-200);
      background: var(--gray-50);
    }

    .report-meta {
      display: flex;
      align-items: center;
      justify-content: between;
      gap: var(--space-3);
      margin-bottom: var(--space-3);
    }

    .technician-info {
      display: flex;
      align-items: center;
      gap: var(--space-3);
      flex: 1;
    }

    .technician-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--emerald-500), var(--primary-500));
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: var(--text-base);
      flex-shrink: 0;
      box-shadow: var(--shadow-md);
    }

    .technician-details {
      min-width: 0;
    }

    .technician-name {
      font-weight: 600;
      color: var(--text-primary);
      font-size: var(--text-sm);
      margin-bottom: var(--space-1);
    }

    .report-date {
      font-size: var(--text-xs);
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: var(--space-1);
    }

    .status-badge {
      padding: var(--space-2) var(--space-3);
      border-radius: var(--radius-full);
      font-size: var(--text-xs);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      display: inline-flex;
      align-items: center;
      gap: var(--space-1);
    }

    .status-pending {
      background: var(--orange-100);
      color: var(--orange-800);
    }

    .status-approved {
      background: var(--emerald-100);
      color: var(--emerald-800);
    }

    .status-rejected {
      background: var(--red-100);
      color: var(--red-800);
    }

    .report-description {
      color: var(--text-secondary);
      font-size: var(--text-sm);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      cursor: pointer;
    }

    .report-description.expanded {
      -webkit-line-clamp: unset;
      display: block;
    }

    .report-images {
      padding: var(--space-6);
      background: var(--gray-50);
    }

    .images-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-4);
    }

    .image-container {
      position: relative;
      border-radius: var(--radius-xl);
      overflow: hidden;
      aspect-ratio: 4/3;
      background: var(--gray-200);
      cursor: pointer;
      transition: var(--transition-transform);
    }

    .image-container:hover {
      transform: scale(1.02);
    }

    .image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .image-label {
      position: absolute;
      top: var(--space-2);
      left: var(--space-2);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: var(--space-1) var(--space-2);
      border-radius: var(--radius-md);
      font-size: var(--text-xs);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      backdrop-filter: blur(10px);
    }

    .image-label.before {
      background: rgba(239, 68, 68, 0.9);
    }

    .image-label.after {
      background: rgba(34, 197, 94, 0.9);
    }

    .no-image {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--text-muted);
      font-size: var(--text-sm);
      text-align: center;
      padding: var(--space-4);
    }

    .no-image i {
      font-size: var(--text-2xl);
      margin-bottom: var(--space-2);
      opacity: 0.5;
    }

    .report-actions {
      padding: var(--space-6);
      background: white;
      display: flex;
      gap: var(--space-3);
      flex-wrap: wrap;
    }

    .action-btn {
      flex: 1;
      min-width: 120px;
      padding: var(--space-3) var(--space-4);
      border: none;
      border-radius: var(--radius-xl);
      font-weight: 600;
      font-size: var(--text-sm);
      cursor: pointer;
      transition: var(--transition-all);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      text-decoration: none;
    }

    .action-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      text-decoration: none;
    }

    .btn-approve {
      background: linear-gradient(135deg, var(--emerald-500), var(--emerald-600));
      color: white;
    }

    .btn-approve:hover {
      background: linear-gradient(135deg, var(--emerald-600), var(--emerald-700));
      color: white;
    }

    .btn-reject {
      background: linear-gradient(135deg, var(--red-500), var(--red-600));
      color: white;
    }

    .btn-reject:hover {
      background: linear-gradient(135deg, var(--red-600), var(--red-700));
      color: white;
    }

    .btn-details {
      background: var(--gray-100);
      color: var(--text-secondary);
      border: 2px solid var(--gray-300);
    }

    .btn-details:hover {
      background: var(--gray-200);
      color: var(--text-primary);
      border-color: var(--gray-400);
    }

    .empty-state {
      text-align: center;
      padding: var(--space-20) var(--space-6);
      color: var(--text-muted);
      background: white;
      border-radius: var(--radius-3xl);
      box-shadow: var(--shadow-xl);
      border: 1px solid var(--gray-200);
    }

    .empty-state i {
      font-size: var(--text-6xl);
      margin-bottom: var(--space-6);
      opacity: 0.3;
      color: var(--emerald-400);
    }

    .empty-state h3 {
      font-size: var(--text-2xl);
      font-weight: 700;
      margin-bottom: var(--space-3);
      color: var(--text-secondary);
    }

    .empty-state p {
      color: var(--text-muted);
      font-size: var(--text-lg);
      max-width: 400px;
      margin: 0 auto;
    }

    /* Modal Styles */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition-all);
    }

    .modal-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: white;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-2xl);
      max-width: 90vw;
      max-height: 90vh;
      overflow: auto;
      transform: scale(0.9);
      transition: var(--transition-all);
    }

    .modal-backdrop.show .modal {
      transform: scale(1);
    }

    .modal-header {
      padding: var(--space-6);
      border-bottom: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--gray-50);
    }

    .modal-title {
      font-size: var(--text-xl);
      font-weight: 700;
      color: var(--text-primary);
      margin: 0;
    }

    .btn-close {
      background: none;
      border: none;
      font-size: var(--text-xl);
      cursor: pointer;
      color: var(--text-muted);
      padding: var(--space-2);
      border-radius: var(--radius-lg);
      transition: var(--transition-colors);
    }

    .btn-close:hover {
      color: var(--text-primary);
      background: var(--gray-200);
    }

    .modal-body {
      padding: var(--space-6);
    }

    .modal-footer {
      padding: var(--space-6);
      border-top: 1px solid var(--gray-200);
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: var(--space-3);
      background: var(--gray-50);
    }

    .rejection-form textarea {
      width: 100%;
      min-height: 120px;
      padding: var(--space-4);
      border: 2px solid var(--gray-300);
      border-radius: var(--radius-xl);
      resize: vertical;
      font-family: inherit;
      font-size: var(--text-base);
      transition: var(--transition-all);
    }

    .rejection-form textarea:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 4px var(--primary-100);
    }

    .rejection-form label {
      display: block;
      margin-bottom: var(--space-2);
      font-weight: 600;
      color: var(--text-primary);
    }

    @media (max-width: 768px) {
      .reports-hero {
        padding: var(--space-8) 0;
      }

      .reports-title {
        font-size: var(--text-2xl);
      }

      .reports-subtitle {
        font-size: var(--text-base);
      }

      .reports-container {
        margin: calc(-1 * var(--space-6)) var(--space-4) var(--space-12);
      }

      .reports-grid {
        grid-template-columns: 1fr;
        gap: var(--space-6);
      }

      .report-card {
        border-radius: var(--radius-2xl);
      }

      .filter-tabs {
        gap: var(--space-1);
      }

      .filter-tab {
        padding: var(--space-2) var(--space-4);
        font-size: var(--text-xs);
      }

      .report-actions {
        flex-direction: column;
      }

      .action-btn {
        min-width: auto;
      }
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="container">
      <div class="navbar-content">
        <a href="{{ url_for('main.home') }}" class="navbar-brand">
          <img src="{{ url_for('static', filename='images/cityfixlogo.png') }}" alt="CityFix Logo" width="32"
            height="32" class="rounded-lg">
          <span>CityFix</span>
        </a>

        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="{{ url_for('auth.dashboard') }}" class="nav-link">
              <i class="bi bi-speedometer2" aria-hidden="true"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="{{ url_for('reports.report_issue') }}" class="nav-link">
              <i class="bi bi-plus-circle" aria-hidden="true"></i>
              <span>Report Issue</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="{{ url_for('user_roles.edit_user_roles') }}" class="nav-link">
              <i class="bi bi-people" aria-hidden="true"></i>
              <span>Manage Users</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="{{ url_for('main.profile') }}" class="nav-link">
              <i class="bi bi-person-circle" aria-hidden="true"></i>
              <span>Profile</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="{{ url_for('auth.logout') }}" class="btn btn-outline-primary">
              <i class="bi bi-box-arrow-right" aria-hidden="true"></i>
              <span>Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Reports Hero -->
  <section class="reports-hero">
    <div class="container">
      <div class="reports-content">
        <h1 class="reports-title">Completed Work Reports</h1>
        <p class="reports-subtitle">
          Review maintenance work completed by technicians.
          Approve quality work or provide feedback for improvements.
        </p>

        <div class="filter-tabs">
          <button class="filter-tab active" onclick="filterReports('all')">
            <i class="bi bi-list-ul" aria-hidden="true"></i>
            <span>All Reports</span>
          </button>
          <button class="filter-tab" onclick="filterReports('pending')">
            <i class="bi bi-clock" aria-hidden="true"></i>
            <span>Pending Review</span>
          </button>
          <button class="filter-tab" onclick="filterReports('approved')">
            <i class="bi bi-check-circle" aria-hidden="true"></i>
            <span>Approved</span>
          </button>
          <button class="filter-tab" onclick="filterReports('rejected')">
            <i class="bi bi-x-circle" aria-hidden="true"></i>
            <span>Rejected</span>
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Reports Container -->
  <main class="container">
    <div class="reports-container">
      {% if done_reports %}
      <div class="reports-grid" id="reports-grid">
        {% for dr in done_reports %}
        <div class="report-card" data-status="{{ 'approved' if dr.issue_status == 'done' else 'pending' }}">
          <!-- Report Header -->
          <div class="report-header">
            <div class="report-meta">
              <div class="technician-info">
                <div class="technician-avatar">
                  {{ dr.technician[0]|upper if dr.technician else 'T' }}
                </div>
                <div class="technician-details">
                  <div class="technician-name">{{ dr.technician or 'Unknown Technician' }}</div>
                  <div class="report-date">
                    <i class="bi bi-calendar3" aria-hidden="true"></i>
                    {{ dr.display_date }} at {{ dr.display_time }}
                  </div>
                </div>
              </div>

              <span class="status-badge {{ 'status-approved' if dr.issue_status == 'done' else 'status-pending' }}">
                <i class="bi bi-{{ 'check-circle' if dr.issue_status == 'done' else 'clock' }}" aria-hidden="true"></i>
                {{ 'Approved' if dr.issue_status == 'done' else 'Pending Review' }}
              </span>
            </div>

            <div class="report-description" onclick="toggleDescription(this)">
              {{ dr.completion_description or 'No description provided.' }}
            </div>
          </div>

          <!-- Report Images -->
          <div class="report-images">
            <div class="images-grid">
              <!-- Before Image -->
              <div class="image-container"onclick="showImageModal('{{ url_for('done_reports.serve_done_upload', file_id=dr.before_file_id) if dr.before_file_id }}')">
                {% if dr.before_file_id %}
                <img src="{{ url_for('done_reports.serve_done_upload', file_id=dr.before_file_id) }}"
                  alt="Before image">
                <div class="image-label before">Before</div>
                {% else %}
                <div class="no-image">
                  <i class="bi bi-image" aria-hidden="true"></i>
                  <span>No Before Image</span>
                </div>
                {% endif %}
              </div>

              <!-- After Image -->
              <div class="image-container"onclick="showImageModal('{{ url_for('done_reports.serve_done_upload', file_id=dr.after_file_id) if dr.after_file_id }}')">
                {% if dr.after_file_id %}
                <img src="{{ url_for('done_reports.serve_done_upload', file_id=dr.after_file_id) }}" alt="After image">
                <div class="image-label after">After</div>
                {% else %}
                <div class="no-image">
                  <i class="bi bi-image" aria-hidden="true"></i>
                  <span>No After Image</span>
                </div>
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Report Actions -->
          <div class="report-actions">
            {% if dr.issue_status != 'done' %}
            <form action="{{ url_for('done_reports.review_done_report', dr_id=dr._id) }}" method="post"
              style="flex: 1;">
              <input type="hidden" name="status" value="accepted">
              <button type="submit" class="action-btn btn-approve">
                <i class="bi bi-check-circle" aria-hidden="true"></i>
                Approve Work
              </button>
            </form>

            <button class="action-btn btn-reject" onclick="showRejectModal('{{ dr._id }}')">
              <i class="bi bi-x-circle" aria-hidden="true"></i>
              Reject Work
            </button>
            {% else %}
            <span class="action-btn btn-details" style="cursor: default;">
              <i class="bi bi-check-all" aria-hidden="true"></i>
              Work Approved
            </span>
            {% endif %}

            <button class="action-btn btn-details"onclick="showDescriptionModal('{{ dr.completion_description or 'No description provided.' }}', '{{ dr.technician }}', '{{ dr.display_date }} {{ dr.display_time }}')">
              <i class="bi bi-eye" aria-hidden="true"></i>
              View Details
            </button>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <i class="bi bi-clipboard-check" aria-hidden="true"></i>
        <h3>No Completed Reports</h3>
        <p>There are no completed work reports to review at this time. Reports will appear here once technicians submit
          their completed work.</p>
      </div>
      {% endif %}
    </div>
  </main>

  <!-- Image Modal -->
  <div id="image-modal" class="modal-backdrop" onclick="closeImageModal()">
    <div class="modal" onclick="event.stopPropagation()" style="max-width: 80vw;">
      <div class="modal-header">
        <h3 class="modal-title">Work Image</h3>
        <button class="btn-close" onclick="closeImageModal()">
          <i class="bi bi-x-lg" aria-hidden="true"></i>
        </button>
      </div>
      <div class="modal-body text-center">
        <img id="modal-image" src="" alt="Work image"
          style="max-width: 100%; height: auto; border-radius: var(--radius-xl);">
      </div>
    </div>
  </div>

  <!-- Description Modal -->
  <div id="description-modal" class="modal-backdrop" onclick="closeDescriptionModal()">
    <div class="modal" onclick="event.stopPropagation()" style="max-width: 600px;">
      <div class="modal-header">
        <h3 class="modal-title">Work Report Details</h3>
        <button class="btn-close" onclick="closeDescriptionModal()">
          <i class="bi bi-x-lg" aria-hidden="true"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="mb-4">
          <strong>Technician:</strong> <span id="modal-technician"></span>
        </div>
        <div class="mb-4">
          <strong>Completed:</strong> <span id="modal-date"></span>
        </div>
        <div>
          <strong>Description:</strong>
          <p id="modal-description" class="mt-2 p-4 bg-gray-50 rounded-xl"></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Reject Modal -->
  <div id="reject-modal" class="modal-backdrop" onclick="closeRejectModal()">
    <div class="modal" onclick="event.stopPropagation()" style="max-width: 500px;">
      <form id="reject-form" method="post">
        <div class="modal-header">
          <h3 class="modal-title">Reject Work Report</h3>
          <button type="button" class="btn-close" onclick="closeRejectModal()">
            <i class="bi bi-x-lg" aria-hidden="true"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="rejection-form">
            <label for="rejection-reason">
              Please explain why this work is being rejected:
            </label>
            <textarea id="rejection-reason" name="rejection_reason"
              placeholder="Explain what needs to be improved or redone..." required></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeRejectModal()">
            Cancel
          </button>
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-x-circle" aria-hidden="true"></i>
            Reject Work
          </button>
        </div>
        <input type="hidden" name="status" value="rejected">
      </form>
    </div>
  </div>

  <script>
    // Filter functionality
    function filterReports(status) {
      const tabs = document.querySelectorAll('.filter-tab');
      const cards = document.querySelectorAll('.report-card');

      // Update active tab
      tabs.forEach(tab => tab.classList.remove('active'));
      event.target.classList.add('active');

      // Filter cards
      cards.forEach(card => {
        if (status === 'all') {
          card.style.display = 'block';
        } else {
          const cardStatus = card.dataset.status;
          card.style.display = cardStatus === status ? 'block' : 'none';
        }
      });
    }

    // Toggle description
    function toggleDescription(element) {
      element.classList.toggle('expanded');
    }

    // Image modal
    function showImageModal(src) {
      if (!src) return;
      document.getElementById('modal-image').src = src;
      document.getElementById('image-modal').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeImageModal() {
      document.getElementById('image-modal').classList.remove('show');
      document.body.style.overflow = 'auto';
    }

    // Description modal
    function showDescriptionModal(description, technician, date) {
      document.getElementById('modal-description').textContent = description;
      document.getElementById('modal-technician').textContent = technician;
      document.getElementById('modal-date').textContent = date;
      document.getElementById('description-modal').classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeDescriptionModal() {
      document.getElementById('description-modal').classList.remove('show');
      document.body.style.overflow = 'auto';
    }

    // Reject modal
    function showRejectModal(reportId) {
      const form = document.getElementById('reject-form');
      form.action = `/admin/review_done_report/${reportId}`;
      document.getElementById('reject-modal').classList.add('show');
      document.body.style.overflow = 'hidden';
      document.getElementById('rejection-reason').focus();
    }

    function closeRejectModal() {
      document.getElementById('reject-modal').classList.remove('show');
      document.body.style.overflow = 'auto';
      document.getElementById('rejection-reason').value = '';
    }

    // Handle escape key
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeImageModal();
        closeDescriptionModal();
        closeRejectModal();
      }
    });

    // Form submission handling
    document.addEventListener('DOMContentLoaded', function () {
      // Add loading states to forms
      document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function () {
          const submitBtn = this.querySelector('button[type="submit"]');
          if (submitBtn) {
            submitBtn.disabled = true;
            const originalContent = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split" aria-hidden="true"></i> Processing...';

            // Re-enable after 3 seconds if form doesn't redirect
            setTimeout(() => {
              submitBtn.disabled = false;
              submitBtn.innerHTML = originalContent;
            }, 3000);
          }
        });
      });

      // Auto-resize textareas
      document.querySelectorAll('textarea').forEach(textarea => {
        textarea.addEventListener('input', function () {
          this.style.height = 'auto';
          this.style.height = (this.scrollHeight) + 'px';
        });
      });

      // Confirmation dialogs for approvals
      document.querySelectorAll('form[action*="review_done_report"]').forEach(form => {
        if (form.querySelector('input[value="accepted"]')) {
          form.addEventListener('submit', function (e) {
            if (!confirm('Are you sure you want to approve this work? This action will mark the original report as completed.')) {
              e.preventDefault();
            }
          });
        }
      });
    });

    // Auto-refresh every 2 minutes
    setInterval(() => {
      // You can implement live updates here
      console.log('Checking for new reports...');
    }, 120000);

    // Keyboard shortcuts  
    document.addEventListener('keydown', function (e) {
      // 1-4 keys for filter tabs
      if (e.key >= '1' && e.key <= '4') {
        const tabs = document.querySelectorAll('.filter-tab');
        const index = parseInt(e.key) - 1;
        if (tabs[index]) {
          tabs[index].click();
        }
      }
    });
  </script>
</body>

</html>